<!DOCTYPE html>
<html>
<head>
  <title>Complete Payment</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>

<body style="display:flex;align-items:center;justify-content:center;height:100vh">

<script>
  const options = {
    key: "<%= razorpayKeyId %>",
    amount: "<%= order.amount %>",
    currency: "INR",
    name: "DropPoint",
    description: "Locker Drop-Off",
    order_id: "<%= order.id %>",
    handler: function (response) {
      fetch("/terminal/payment/verify", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          razorpay_payment_id: response.razorpay_payment_id,
          razorpay_order_id: response.razorpay_order_id,
          razorpay_signature: response.razorpay_signature,
          parcelId: "<%= parcel._id %>",
        }),
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
           window.location.href = `/terminal/parcel/<%= parcel._id %>/access`;
        } else {
          alert("Payment verification failed");
        }
      });
    },
    prefill: {
      contact: "<%= parcel.senderPhone %>"
    },
    theme: { color: "#ff7b00" }
  };

  new Razorpay(options).open();
</script>

</body>
</html>
